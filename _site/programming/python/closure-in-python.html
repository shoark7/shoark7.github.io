<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Python의 Closure에 대해 알아보자 - Parkito's on the way</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Parkito's on the way" property="og:site_name">
  
    <meta content="Python의 Closure에 대해 알아보자" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Python에서 유용한 Closure에 대해 살펴봅니다." property="og:description">
  
  
    <meta content="http://localhost:4000/programming/python/closure-in-python" property="og:url">
	
  
    <meta content="2019-04-22T00:00:00+09:00" property="article:published_time">
    <meta content="http://localhost:4000/about/" property="article:author">
  
  
    <meta content="http://localhost:4000/assets/img/python/closure-logo.jpg" property="og:image">
  
  
    
    <meta content="Programming" property="article:section">
    
  
  
    
    <meta content="Closure" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="Python의 Closure에 대해 알아보자">
  
  
    <meta name="twitter:url" content="http://localhost:4000/programming/python/closure-in-python">
  
  
    <meta name="twitter:description" content="Python에서 유용한 Closure에 대해 살펴봅니다.">
  
  
    <meta name="twitter:image:src" content="http://localhost:4000/assets/img//python/closure-logo.jpg">
  

  
    <meta content="Python에서 유용한 Closure에 대해 살펴봅니다." name="description">
  
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">

	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<!-- Mathjax Support -->

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

<script>
MathJax = {
  tex: {
    packages: ['base', 'autoload'],        // extensions to use
    inlineMath: [              // start/end delimiter pairs for in-line math
      ['\\(', '\\)']
    ],
    displayMath: [             // start/end delimiter pairs for display math
      ['$$', '$$'],
      ['\\[', '\\]']
    ],
    processEscapes: true,      // use \$ to produce a literal dollar sign
    processEnvironments: true, // process \begin{xxx}...\end{xxx} outside math mode
    processRefs: true,         // process \ref{...} outside of math mode
    digits: /^(?:[0-9]+(?:\{,\}[0-9]{3})*(?:\.[0-9]*)?|\.[0-9]+)/,
                               // pattern for recognizing numbers
    tags: 'none',              // or 'ams' or 'all'
    tagSide: 'right',          // side for \tag macros
    tagIndent: '0.8em',        // amount to indent tags
    useLabelIds: true,         // use label name rather than tag for ids
    multlineWidth: '85%',      // width of multline environment
    maxMacros: 1000,           // maximum number of macro substitutions per expression
    maxBuffer: 5 * 1024,       // maximum size for the internal TeX string (5K)
    baseURL:                   // URL for use with links to tags (when there is a <base> tag in effect)
       (document.getElementsByTagName('base').length === 0) ?
        '' : String(document.location).replace(/#.*$/, ''),
    formatError:               // function called when TeX syntax errors occur
        (jax, err) => jax.formatError(err)
  }
};
</script>

	<link rel="stylesheet" href="/assets/css/main.css">
	<link rel="stylesheet" href="/assets/css/personal.css">
	<link href="https://fonts.googleapis.com/css?family=Do+Hyeon|Nanum+Gothic:400,700,800&amp;subset=korean" rel="stylesheet">

	<!-- googld ads tag -->
  <script data-ad-client="ca-pub-2670967175857332" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body style="position: relative">
	<div id="toggler-wrapper">
		<div id="menu-toggler">
			<img src="/assets/img/nav-off.png" alt="Menu collapse image">
		</div>
	</div>

  <div class="wrapper">

		<nav id="nav">
			<div id="menus">
				<p>
					<a class="navbar-brand text-white" href="/">&nbsp;&nbsp;&nbsp;Parkito's on the way!&nbsp;&nbsp;&nbsp;</a>
				</p>
				<ul id="category-list">
					<li>
						<a href="/about.me">
							<div class="menu">
								<span> About </span>
							</div>
						</a>
					</li>
				
					<li>
						<div class="menu-wrapper">
							<a href="/category/programming">
								<div class="menu">
									<span> Programming </span>
								</div>
							</a>
							<div class="menu-item">
								<a href="/category/programming/knowledge">Knowledge</a>
								<a href="/category/programming/algorithm">Algorithm</a>
								<a href="/category/programming/python">Python</a>
								<a href="/category/programming/shell-programming">Shell programming</a>
							</div>
						</div>
					</li>
				
					<li>
						<div class="menu-wrapper">
								<a href="/category/insight">
									<div class="menu">
										<span> Insight </span>
									</div>
								</a>
								<div class="menu-item">
									<a href="/category/insight/sensitivity">&nbsp;&nbsp;Sensitivity&nbsp;&nbsp;</a>
									<a href="/category/insight/rationality">&nbsp;&nbsp;Rationality&nbsp;&nbsp;</a>
								</div>
						</div>
					</li>

					<li>
						<div class="menu-wrapper">
								<a href="/category/projects">
									<div class="menu">
										<span> Projects </span>
									</div>
								</a>
							<div class="menu-item">
								<a href="/category/projects/dev-related">&nbsp;&nbsp;Dev related&nbsp;&nbsp;</a>
								<a href="/category/projects/etc">&nbsp;&nbsp;ETC&nbsp;&nbsp;</a>
							</div>
						</div> </li>

				</ul>
			</div>

			<div id="menus-right">
				<div id="search-section">
					<div class="input-wrapper">
						<span class="fa fa-search"></span>
						<input type="text" id="search-input" placeholder="Please input specific keyword :)" size="30">
					</div>
					<div id="results-container"></div>
				</div>

				<!--<div id="toggler-wrapper">-->
					<!--<div id="menu-toggler">-->
						<!--<img src="/assets/img/nav-off.png" alt="" width="35px" height="35px">-->
					<!--</div>-->
				<!--</div>-->
				
			</div>
			
		</nav>


    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/1536558558520.jpg" alt="Sunghwan Park"></a>
      </div>
      <div class="author-name">Sunghwan Park</div>
      <p>I'm Parkito. A Python lover. Interested in Python, Automation, Algorithm. Please give me insights. I'll teach you tambien! :)</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
				<!--
        
          <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        
          <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
        
				-->
        
          <li class="github"><a href="http://github.com/shoark7" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
          <li class="linkedin"><a href="https://in.linkedin.com/in/sunghwan-park-3773b8154" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        
        
          <li class="email"><a href="mailto:shoark7@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2021 &copy; Sunghwan Park</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->

<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <figure>
        <img class="page-image" src=/assets/img//python/closure-logo.jpg alt="Python의 Closure에 대해 알아보자">
        
      </figure>
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Python의 Closure에 대해 알아보자</h1>
        <div class="page-date"><span>2019, Apr 22&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>

		<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- 처음과끝에만 -->
		<ins class="adsbygoogle"
				 style="display:block"
				 data-ad-client="ca-pub-2670967175857332"
				 data-ad-slot="3352812061"
				 data-ad-format="auto"
				 data-full-width-responsive="true"></ins>
		<script>
				 (adsbygoogle = window.adsbygoogle || []).push({});
		</script>
		<!-- 처음과끝에만 -->

      <h2 id="0-index">0. Index</h2>

<blockquote>
  <ol>
    <li><a href="#1">들어가며</a></li>
    <li><a href="#2">배경지식</a>
      <ul>
        <li>2.1. <a href="#2a">함수 중첩(Function nesting)</a></li>
        <li>2.2. <a href="#2b">First Class Object</a></li>
        <li>2.3. <a href="#2c">nonlocal</a></li>
      </ul>
    </li>
    <li><a href="#3">Closure에 대한 이해</a>
      <ul>
        <li>3.1. <a href="#3a">Closure 단어의 의미는?</a></li>
        <li>3.2. <a href="#3b">기본 정의</a></li>
        <li>3.2. <a href="#3c">Closure의 특징</a></li>
      </ul>
    </li>
    <li><a href="#4">Closure 사용시의 장점</a></li>
    <li><a href="#5">마치며</a></li>
    <li><a href="#6">자료 출처</a></li>
  </ol>
</blockquote>

<p><br id="1" /></p>

<h2 id="1-들어가며">1. 들어가며</h2>

<hr />

<p><strong>오늘은 Python의 <code class="highlighter-rouge">Closure</code>에 대해 알아본다.</strong> 해야지 해야지 하고 미룬 포스트인데 이제야 하게 됐다. 난 Closure가 단순히 함수 내 중첩 함수를 의미하는지 알았는데 밑에서 살펴보겠지만 그건 완전한 내 착각이었다.</p>

<p>이 포스트도 앞의 두 포스트와 마찬가지로 영어로 할까 했다. 그렇게 하지 않고 한글로 한 이유는 이 <em>Closure</em> 의 뜻에 대해 나름의 깨달음을 얻었기 때문이다. ‘Closure’를 그냥 영어 단어로 해석하면 ‘폐쇄’란다. 그렇게 보면 답도 없다. 내가 나름 생각한 의미를 공유하기에는 독자가 영어가 모국어가 아닌 사람들이 적절하겠다 싶어서 한글로 작성한다.</p>

<p><br /></p>

<p><strong>포스트는 먼저 Closure에 대해 바로 들어가기 전에 필요한 배경지식을 살펴본다. 함수의 중첩, 일급 객체, 파이썬의 nonlocal 스코프에 대한 이해가 선행되어야 하는데, 충분히 이해하고 있는 독자들은 바로 3장으로 넘어가면 된다.</strong></p>

<p>그리고 <strong>Closure에 대해 살핀다. Closure라는 단어의 의미를 먼저 음미하고, 파이썬에서의 기본 정의, 특징, 사용시의 장점에 대해 살핀다.</strong></p>

<p>들어가겠습니다. :)</p>

<p><br id="2" /></p>

<h2 id="2-배경지식">2. 배경지식</h2>

<hr />

<p>클로저에 대해 살펴보기 전에 3가지 개념을 짚고 넘어가야 한다. <strong>함수 중첩과 일급 객체, 그리고 nonlocal.</strong> 파이썬에서 이 세 가지 개념은 클로저를 구성하는 기본요소이기 때문에 먼저 살핀다. 특히 <strong>nonlocal에 대해 잘 모른다면 이 부분만큼은 꼭 눈여겨보도록 하자.</strong></p>

<p><br id="2a" /></p>

<h3 id="21-함수-중첩function-nesting">2.1. 함수 중첩(Function nesting)</h3>

<p>Python(이하 “파이썬”)에서 if 조건문 등은 중첩이 된다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">"정수를 입력하세요"</span><span class="p">))</span>

<span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"6의 배수군요?"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"짝수로소이다 ㅎㅎ"</span><span class="p">)</span>
</code></pre></div></div>

<p>인터프리터에 ‘<em>import this</em>‘라고 입력하면 나오면 유려한 시 <strong>‘<em>Zen of Python</em>‘에서는 가급적 중첩을 피하라고 이야기하고 있다.</strong> 하지만 중첩을 해야만 하는 경우도 있기 때문에 중첩이 틀린 건 아니다.</p>

<p><br /></p>

<p>그리고 <strong>파이썬에서는 함수도 중첩 선언이 된다.</strong> 그러니까 함수 정의 안에 다른 함수를 정의할 수 있는 것이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">greetings</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">say_hi</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Hi, everyone :)"</span><span class="p">)</span>

    <span class="n">say_hi</span><span class="p">()</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">greetings</span><span class="p">()</span>
    
<span class="n">Hi</span><span class="p">,</span> <span class="n">everyone</span> <span class="p">:)</span>
</code></pre></div></div>

<p>인사를 건네는 <em>greetings</em> 함수를 만들었다. 이 함수는 실제 인사를 건네는 코드를 다른 함수로 감싸서 이 내부 함수를 호출하고 있다. 이 코드는 전혀 문제가 없다.</p>

<p>난 이렇게 내부 함수를 짜면 이게 다 Closure인 줄 알았다. 하지만 그건 틀린 생각이었고, 함수 중첩은 Closure이기 위한 필요조건이지 충분조건이 아니다.</p>

<hr />

<p><br id="2b" /></p>

<h3 id="22-first-class-object">2.2. First Class Object</h3>

<p>좀 생소한 개념이 나왔다. 그런데 생각보다 어렵지는 않다.</p>

<p><strong>프로그래밍 언어에서 First Class Object(또는 First Class Citizen, 일급 객체)는 해당 언어 내에서 일반적으로 다른 모든 개체에 통용가능한 동작(operation)이 지원되는 개체(entity)를 의미한다.</strong></p>

<p>이 동작은 주로</p>

<ol>
  <li><strong>함수의 인자로 전달되거나,</strong></li>
  <li><strong>함수의 반환값이 되거나,</strong></li>
  <li><strong>수정되고 할당되는 것들을 전제로 한다.</strong></li>
</ol>

<p><br /></p>

<p>이게 무슨 뜻일까? 어렵지 않다. 파이썬에서 가장 많이 쓰이는 자료타입이 뭐가 있을까? <strong><em>list</em>, <em>str</em>, <em>int</em> 등등이 쉽게 떠오른다. 이렇게 기본적이고 유명한 자료타입들은 함수의 인자로 전달되거나, 반환값이 되거나, 수정되고 할당될 수 있다.(적어도 개념적으로는)</strong></p>

<p>이런 자료형은 파이썬의 1급 객체다.(First Class Object) 파이썬을 오래 한 나에게는 이게 상식적이고 당연한데 그렇지 않은 언어들이 있나보다. 가령 C 언어에서는 함수의 인자로 함수의 포인터를 전달할 수는 있어도, 함수의 이름을 전달할 수는 없다. <strong>기술적으로 포인터가 일급 객체라는 표현은 맞아도 함수가 일급 객체라는 표현은 적절하지 않은 것이다.</strong></p>

<p><br /></p>

<p>반면 <strong>파이썬에서는 함수(function)도 1급 객체다. 함수에는 위의 기본 자료타입들에 적용가능한 동작들이 똑같이 적용 가능하다.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="c1"># 2.
</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">add</span> <span class="c1"># 3.
</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">execute</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># 1.
</span>
<span class="mi">8</span>
</code></pre></div></div>

<p>Packing과 Unpacking을 활용한 간단한 예제이다. 두 수의 합을 반환하는 함수 <em>add</em> 를 정의했는데 이를 직접 호출하지 않고 감싸는 <em>execute</em> 함수를 만들었다.</p>

<p>이 예제에서 앞서 이야기한 1급 객체에 적용가능한 동작이 모두 적용되었다.</p>

<ol>
  <li><strong><em>f</em> 라는 함수가 <em>execute</em> 의 함수의 인자로 전달되었고,</strong></li>
  <li><strong>함수 내부에서 인자로 받은 함수 <em>func</em> 를 문제없이 사용하고 있으며,</strong></li>
  <li><strong><em>add</em> 라는 원 함수의 이름이 마음에 안 들었는지 <em>f</em> 라는 새 이름에 할당했다.</strong></li>
</ol>

<p><br /></p>

<p>즉, <strong>파이썬에서 함수는 1급 객체이다.</strong> 이 특성이 있어야 Closure가 성립될 수 있다.</p>

<hr />

<p><br id="2c" /></p>

<h3 id="23-nonlocal">2.3. nonlocal</h3>

<p>이 개념은 중요하다. 꼭 Closure가 아니라도 의미가 있기에 조금 길게 설명하자. 먼저 간단한 예시를 들고 가자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">z</span> <span class="o">=</span> <span class="mi">3</span>

<span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">return</span> <span class="n">inner</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">outer</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div></div>

<p>앞서 파이썬에서 함수 중첩이 가능하다는 것을 확인했다. 그건 그런데, <strong>위의 함수에는 <em>x</em> 값에 대한 코드가 두 번 제시됐다.</strong> 처음은 함수 실행 시에 받는 임의의 <em>x</em> 이고, 다음은 <em>inner</em> 함수 내에서 1000으로 초기화하는 변수 <em>x</em> 이다. 예시처럼 함수 호출 시 인자를 10으로 줬을 때 반환되는 값은 몇이어야 하는가?</p>

<p><br /></p>

<p>위와 같은 이슈는 결국 <strong>scope</strong>에 대한 이야기다. <strong><em>inner</em> 함수 입장에서 바라보겠다.</strong></p>

<ul>
  <li><strong><em>inner</em> 함수 블록 안에 있는 영역은 <em>local</em> 스코프라고 불린다. 로컬 영역 안의 모든 개체들은 <em>inner</em> 의 제어 아래에 있다.</strong></li>
  <li><strong><em>outer</em> 의 안에 있되, <em>inner</em> 의 밖에 있는 영역은 <em>nonlocal</em> 스코프라고 불린다. <em>outer</em> 의 <em>y</em> 변수는 <em>inner</em> 입장에서는 <em>nonlocal</em> 스코프의 변수이다.</strong></li>
  <li><strong><em>outer</em> 함수 밖의 영역은 <em>global</em> 스코프다. <em>z</em> 변수는 <em>global</em> 에 선언된 변수로 <em>outer</em> 함수뿐 아니라 다른 코드나 함수에서도 참조가능할 것이다.</strong></li>
</ul>

<p><br /></p>

<p>이런 <em>global</em>, <em>nonlocal</em>, <em>local</em> 의 구분, 다시 말해 스코프(namespace라고 말할 수도 있을 것이다.)의 구분은 어떤 의미가 있는가? <strong>각 스코프는 자신의 영역에 최대한의 관심을 가지며, 다른 영역의 변수나 객체에 대해서는 제한적인 제어를 가지게 된다.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">greetings</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">say_hi</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">say_hi</span><span class="p">()</span>


<span class="n">greetings</span><span class="p">(</span><span class="s">'안녕하세요?'</span><span class="p">)</span>

<span class="err">안녕하세요?</span>
</code></pre></div></div>

<p>아까의 예와 비슷하다. <em>say_hi</em> 내부 함수는 <em>nonlocal</em> 영역의 <em>x</em> 의 변수를 그대로 반환하는 기능을 갖고 있다. 그리고 <em>greetings</em> 가 받은 문자열을 문제없이 참조할 수 있었다. <strong>그러니까 외부 스코프의 변수에 대해 ‘읽기’가 문제없이 가능하다고 이해하면 된다.</strong></p>

<p>하지만 <strong>자신의 영역이 아닌 영역에 대해 ‘쓰기’는 제한적이다.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">increment</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">increment</span><span class="p">()</span>


<span class="o">&gt;&gt;&gt;</span> <span class="n">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nb">UnboundLocalError</span><span class="p">:</span> <span class="n">local</span> <span class="n">variable</span> <span class="s">'x'</span> <span class="n">referenced</span> <span class="n">before</span> <span class="n">assignment</span>
</code></pre></div></div>

<p>음 뭐가 문제지? 특이한 에러가 발생했다. <strong><em>UnboundLocalError</em> 로 <em>local</em> 변수 <em>x</em> 가 할당되기 전에 참조됐다는 의미이다.</strong>  하지만 우리는 <em>nonlocal</em> 의 <em>x</em> 에 1을 더한건데?<br />
여기에 트릭이 있다.</p>

<p><strong><em>local</em> 영역에서 밖의 영역에 대한 값을 참조하는, 또는 읽는 것은 항상 문제가 없는데, 값을 수정하거나 새로 할당하는 것은, 쓰는 것(write)은 안 된다.</strong></p>

<p>위에서는 ‘<em>x += 1</em>‘가 ‘수정하는’ 역할을 하고 있다. <strong>파이썬에서는 값을 수정하는, 쓰는 코드가 나오면 따로 언급이 없는 한, <em>increment</em> 함수는 <em>x</em> 가 자신이 제어할 수 있는 <em>local</em> 변수라고 무조건 가정한다.</strong> 함부로 외부의 변수를 건드리는 어려운 버그를 막기 위해서다. 선언하지도 않는 변수에 값을 더하는건 당연히 말이 안 된다. 그래서 로컬 스코프에 변수가 할당이 되지 않았다는 에러가 출력된 것이다.</p>

<p>왜 위와 같이 헷갈리게 만들어놨을까? <strong>그것은 코드 영역의 책임과 권한을 명확히 나누는 것이 좋기 때문이다. 예제의 <em>count</em> 함수는 하나의 내부 함수를 갖고 있지만, 어떤 경우에는 수십여개의 내부 함수를 가질 수도 있다. 이때 내부 함수마다 count의 상태값을 건드리고 수정한다면 예상하지 못한 결과를 초래할 수 있다.</strong> 그래서 읽기는 가능하지만 쓰기는 제한하고 있는 것이다. 리눅스에서 모든 파일에 유저마다, 그룹마다 쓰기와 읽기, 실행에 대한 권한을 따로 제어하는 것은 같은 이치다.</p>

<p>만약 위의 예제에서 의도적으로 <em>nonlocal</em> 스코프의 값을 수정하고 싶으면 어떻게 할까? <strong>이때 <em>nonlocal</em> statement를 쓰면 된다.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">increment</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">x</span>  <span class="c1"># x가 로컬이 아닌 nonlocal의 변수임을 확인한다.
</span>        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">increment</span><span class="p">()</span>

<span class="n">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span>
</code></pre></div></div>

<p><strong><em>increment</em> 함수 정의 바로 아랫줄에 ‘<em>nonlocal x</em>‘라고 선언했다. 이 코드는 <em>x</em> 가 <em>local</em> 변수가 아닌, <em>nonlocal</em>, 여기서는 <em>count</em> 스코프 내의 변수라는 것을 개발자가 명시적으로 선언하는 것으로 <em>nonlocal</em> 영역의 상태에 대해 읽는 것뿐 아니라 쓰는 것도 가능하게 된다.</strong> 같은 식으로 <em>global</em> 스코프의 값을 제어하고 싶다면 ‘<em>global x</em>‘와 같이 사용할 수도 있을 것이다.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">z</span> <span class="o">=</span> <span class="mi">3</span>

<span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">return</span> <span class="n">inner</span><span class="p">()</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">outer</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div></div>

<p>자, 멀리 돌아왔다. 우리의 원 질문은, 저 함수를 실행했을 때 값이 <em>outer</em> 의 10이 나올지, <em>inner</em> 의 1000이 나올지이다. 결과는? (두근두근)</p>

<p>명심하자. <strong>함수는 자신이 제어권을 가장 많이 확보하고 있는, 자신에게 가장 가까운 스코프부터 찾아나아간다.</strong> <em>inner</em> 함수는 자신의 <em>local</em> 스코프에서 <em>x</em> 를 찾았기 때문에 밖의 스코프를 더 이상 찾아볼 이유가 없다. 그렇기 때문에 <em>outer</em> 의 인자로 몇을 주든지 간에 무조건 1000이 나올 것이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">outer</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">outer</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">outer</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="mi">1000</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">1000</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">1000</span>
</code></pre></div></div>

<p><br /></p>

<p>자, 생각보다 길었지만 Closure을 이해하기 위한 세 가지 선행개념을 살펴보았다. 이제 Closure로 넘어가자.</p>

<p><br id="3" /></p>

<h2 id="3-closure에-대한-이해">3. Closure에 대한 이해</h2>

<hr />

<p>이제 기본지식을 바탕으로 closure(이하 “클로저”)에 대해 알아보자. <strong>먼저 아리송한 Closure의 단어의 뜻을 잡고 가자.</strong> 기술용어의 뜻을 제대로 파악하지 못하고 쓰는 것은 절대 지양해야 한다. 이 단어의 개념을 이해하면 클로저의 정의를 파악하고, 특징과 사용 시의 장점에 대해 알아본다.</p>

<p><br id="3a" /></p>

<h3 id="31-closure-단어의-의미는">3.1. Closure 단어의 의미는?</h3>

<p>Closure는 여기서 무슨 의미일까? 이 영어 단어의 의미가 파이썬의 클로저에 던지는 메시지는 무엇일까?</p>

<p>Closure라는 단어에 집착하기 전에 관련된 단어로 <strong><em>enclose</em></strong> 로 우회해서 이해해보자.</p>

<p><strong>Enclose는 <em>close</em> 에 대해 <em>en</em> 접두사가 붙어 (담, 울타리 등으로) ‘두르다’, ‘둘러치다’란 의미를 갖고 있다.</strong>  이 뜻 그대로 이해해보자.</p>

<p><br /></p>

<p>방대한 초원을 공유지로 하여 많은 사람들이 각자의 가축을 기른다고 하자. 누구는 소를 키우고 누구는 양을 키우고… 공유지에서 풀을 먹일 땐 같이 풀어놓더라도, 향후 분명 각자의 소유지에 담을 둘러(enclose) 가축들을 관리할 것이다. 아래 그림은 그 예시이다.</p>

<p><img src="/assets/img/python/enclosure-cage.png" alt="Enclosure png with enclosed cage" /></p>

<p>김가네와 박가네가 서로의 우리에 가축동물을 기르고 있다. 이렇게 각자의 영역을 구축하여(enclose) 동물들을 관리하면 어떤 장점이 있을까?</p>

<p>당연한 얘기지만, <strong>각자의 동물(재산)에 대한 관리와 책임을 명확히 할 수 있고, 서로 다른 재산끼리의 불필요한 충돌을 방지할 수 있으며, 각자의 입맛에 맞게 재산을 관리할 수 있다.</strong> 박가네는 그래프에 대한 깊은 이해가 있어 양들의 배치를 2차원 행렬 그래프에 가깝게 배치했지만, 김가네 목장은 소를 단순히 우리 안에서 방목하고 있다. 각자의 필요나 기호에 맞게 관리한 것이다.</p>

<p><strong>이렇게 어떤 재산이나 속성을 Enclose하여 자신만의 영역을 구축하는 것, 그것의 장점을 이해함으로써 클로저를 더 쉽게 이해할 수 있다.</strong> 이게 본격적인 정의와 특징을 살펴보면서, 클로저의 장점을 다루며 위의 예시를 상기할 것이다.</p>

<hr />

<p><br id="3b" /></p>

<h3 id="32-기본-정의">3.2. 기본 정의</h3>

<p>길고 길었는데 이제 진짜 클로저에 대해 살펴보자. <strong>파이썬에서 클로저는 ‘자신을 둘러싼 스코프(네임스페이스)의 상태값을 기억하는 함수’다.</strong> 그리고 어떤 함수가 클로저이기 위해서는 다음의 세 가지 조건을 만족해야 한다.</p>

<ol>
  <li><strong>해당 함수는 어떤 함수 내의 중첩된 함수여야 한다.</strong></li>
  <li><strong>해당 함수는 자신을 둘러싼(enclose) 함수 내의 상태값을 반드시 참조해야 한다.</strong></li>
  <li><strong>해당 함수를 둘러싼 함수는 이 함수를 반환해야 한다.</strong></li>
</ol>

<p><br /></p>

<p>이해를 위해 예시를 들자. 몇 주 전 파이썬에서 팩토리얼을 구하는 5가지 방법에 대한 <a href="https://shoark7.github.io/programming/algorithm/several-ways-to-solve-factorial-in-python.html#4" target="_blank">포스트</a>를 작성했다. 해당 포스트의 말미에서는 효율을 높이기 위한 Memoization을 제시했는데 이 방법은 5가지 알고리즘에 모두 적용가능하다. 그러면 <strong>Memoization 코드를 따로 분리시키고 각 알고리즘에서 그 모듈을 사용한다면 코드를 5번 하드코딩한 것보다 유지보수도 쉽고 가독성도 올라갈 것이 자명하다.</strong>(Modularity, that’s what matters.)</p>

<p>해당 포스트에서 캐시 히트 여부를 검사하는 분리된 모듈 코드는 다음과 같았다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">in_cache</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></div>

<p><em>in_cache</em> 함수는 <em>cache</em> 라는 <em>dict</em> 자료구조와 <em>wrapper</em> 라는 내장 중첩함수를 가지고 있다. 이 중첩함수는 정수 <em>n</em> 를 받아서 <em>n</em> 의 key에 해당하는 value가 <em>cache</em> 에 담겨 있으면 반환하고, 아니면 함수 <em>func</em> 를 실행해서 값을 저장한 뒤 반환한다.</p>

<p><br /></p>

<p>이 함수를 실제로 적용해보기 전에, <em>wrapper</em> 함수에 대해 살펴보자. 위에서 어떤 함수의 클로저이기 위한 특징을 살폈는데 공교롭게도 <strong>이 함수는 클로저이기 위한 조건을 모두 충족한다.</strong></p>

<ol>
  <li><strong><em>in_cache</em> 함수 내의 중첩된 함수이고,</strong></li>
  <li><strong>Enclosing하는 <em>in_cache</em> 스코프의 <em>cache</em> 라는 상태값을 참조하고 있으며,</strong></li>
  <li><strong>자신을 둘러싼 함수는 자신(<em>wrapper</em>)을 반환하고 있다!</strong></li>
</ol>

<p>일단 <em>wrapper</em> 는 정의상 클로저라는 얘기이고, 이 함수를 제대로 사용해보자.</p>

<p>위 포스트의 팩토리얼 함수를 하나 가져와서 <em>in_cache</em> 를 적용해보겠다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">*=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></div>

<p>주어진 정수에 대해 팩토리얼을 구하는 초보적인 코드다. Memoization과 실제 팩토리얼을 구하는 코드가 분리된 상태로 Memoization을 기능에 추가하려면 다음과 같이 작동시킨다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">factorial</span> <span class="o">=</span> <span class="n">in_cache</span><span class="p">(</span><span class="n">factorial</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>그리고 이해를 위해 <em>wrapper</em> 함수에 코드를 한 줄 추가한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">in_cache</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span> <span class="c1">## !!!!
</span>        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">*=</span> <span class="n">i</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="n">factorial</span> <span class="o">=</span> <span class="n">in_cache</span><span class="p">(</span><span class="n">factorial</span><span class="p">)</span>
</code></pre></div></div>

<p>이제 진짜 핵심으로 들어간다. 그 클로저라는 <em>wrapper</em> 함수 안에 <em>cache</em> 의 상태값을 출력하는 코드를 넣었다.</p>

<p>저 코드는 <em>wrapper</em> 을 <em>enclosing</em> 하는 스코프의 <em>cache</em> 변수를 추적한다.</p>

<p>이제 함수를 몇 번 실행해보자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">factorial</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="p">{}</span>
<span class="mi">6</span>

<span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>
<span class="mi">120</span>


<span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">120</span><span class="p">}</span>
<span class="mi">3628800</span>
</code></pre></div></div>

<p>위의 {} 결과가 <em>cache</em> 의 상태고, 그 아래는 <em>n</em> 에 따른 팩토리얼 값이다. 이상한 것을 발견했는가?</p>

<script type="math/tex; mode=display">\text{cache는 함수가 실행됨에 따라 그 상태가 업데이트되고 있다.} \\
\text{이전 결과값을 저장하고 있는 것이다!}</script>

<p>이것을 그림으로 표현하면 다음과 같을 것이다.</p>

<p><img src="/assets/img/python/enclosure-2.png" alt="Enclosure boy~" /></p>

<p>전역 스코프에는 수많은 변수들이 저장되어 있다. 그중에는 <em>factorial</em> 함수도 있다. <strong>이 함수는 원래 정의한 팩토리얼 함수가 아닌, ‘<em>in_cache(factorial)</em>‘의 실행결과 반환된 함수로, 이게 곧 클로저다.</strong>(클로저의 조건 3번) 이 클로저에 다시 한 번 <em>factorial</em> 이라는 이름을 할당해서 사용하는 것뿐, <em>cached_factorial</em> 등의 이름을 붙여도 상관은 없다.</p>

<p><strong>이 클로저는 자체 스코프를 가지고 있어, <em>cache</em> 라는 상태는 매번 실행할 때마다 초기화되는 것이 아니라 값이 유지되고 있다.</strong> 마치 전역공간에 선언이라도 했듯이 말이다.</p>

<p>신기하게도 원래 함수 정의에서 <em>cache</em> 는 <em>wrapper</em> 함수 스코프의 밖에 선언되어 있었다. 그럼에도 <em>wrapper</em>(여기서는 <em>factorial</em>)는 <em>cache</em> 에 접근이 되고, 그 상태를 자신의 스코프 내에서 저장하고 제어할 수 있다.</p>

<p>아까 살펴본 클로저의 정의, <strong>‘클로저는 자신을 둘러싼 스코프(네임스페이스)의 상태값을 기억하는 함수’</strong>는 이런 뜻인 것이다. 이 예에서 <em>factorial</em> 스코프에서는 자신을 둘러싼(enclosing) 스코프의 상태값을(<em>cache</em>) 기억하고 제어할 수 있다.</p>

<p>이를 통해 <strong>자신만의 스코프 내에서 함수 실행시마다 초기화되는 것이 아닌, 지속적으로 관리되고 유지되는 <em>cache</em> 를 두고 소기의 목적을 달성할 수 있다.</strong></p>

<hr />

<p><br id="3c" /></p>

<h3 id="33-closure의-특징">3.3. Closure의 특징</h3>

<p>클로저를 사용할 때의 특징과 장점을 살펴보도록 하자.</p>

<p>일단 눈에 띠는 특징으로 <strong>클로저는 자신을 둘러싼 함수 스코프의 상태값을 참조하는데, 이 값은 함수가 메모리에서 사라져도 값이 유지가 된다.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">times_multiply</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">multiply</span>


<span class="n">times_3</span> <span class="o">=</span> <span class="n">times_multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">times_4</span> <span class="o">=</span> <span class="n">times_multiply</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">times_3</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">times_4</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="mi">15</span>
<span class="mi">20</span>
</code></pre></div></div>

<p>이제는 다른 예제다. <em>times_multiply</em> 는 <em>n</em> 을 받아서 <em>multiply</em> 라는 함수를 반환한다. <strong>이 <em>multiply</em> 내장 중첩함수는 클로저로 상위 스코프의 <em>n</em> 을 참조하고 있다.  결과 <em>times_3</em>, <em>times_4</em> 는 반환된 클로저로 들어온 숫자에 각각 3, 4를 곱해 반환한다.</strong></p>

<p>이때 <em>times_multiply</em> 를 메모리 상에서 삭제하자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">del</span><span class="p">(</span><span class="n">times_multiply</span><span class="p">)</span>
</code></pre></div></div>

<p>그러면 <strong>이 함수는 더 이상 호출할 수 없는데, 이게 기존에 생성된 클로저에도 영향을 미칠까?</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">times_3</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="mi">15</span>
</code></pre></div></div>

<p>문제없이 호출가능하다. <strong>클로저는 원 함수에 어떤 변화(심지어는 삭제)가 발생되어도 자신의 스코프는 지킨다.</strong></p>

<p><br /></p>

<p>두 번째 특징으로 <strong>클로저에서 자신 안에 정의된 내부 변수가 아닌, Enclosing하고 있는 변수에 접근하는 것을 파이썬에서 지원하고 있다.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">times_4</span><span class="o">.</span><span class="n">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span>

<span class="mi">4</span>
</code></pre></div></div>

<p><strong>파이썬 3 기준으로, 클로저 함수는 __closure__ 변수를 자동으로 갖고 있다. 이 변수는 튜플 타입으로서 클로저가 <em>enclosing</em> 스코프에서 참조하는 변수들을 담고 있다. 그리고 각 원소의 <em>cell_contents</em> 는 그 값 자체를 갖고 있다.</strong></p>

<p>위에서는 4라는 값을 감싸는 함수의 인자로 주었기 때문에 저 값은 클로저가 참조하는 값으로 유지된다. 그리고 이 클로저는 값을 하나만 참조했기 때문에 __closure__ 는 길이가 1인 튜틀이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">times_4</span><span class="o">.</span><span class="n">__closure__</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span>


<span class="nb">IndexError</span><span class="p">:</span> <span class="nb">tuple</span> <span class="n">index</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span> 
</code></pre></div></div>

<p>만약 enclosing 스코프에서 값을 여러 개 참조한다면 그 개수만큼 접근가능할 것이다. <strong>클로저가 생성될 때(<em>times_3 = times_multiply(3)</em>) 이 __closure__ 변수가 같이 생성되고 유지되기 때문에 기존 함수가 삭제되어도 문제없이 클로저를 실행할 수 있다.</strong></p>

<p><br /></p>

<p>그리고 내가 좋아하는 <strong>decorator는 결국 클로저를 만드는 문법이다.</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">factorial</span> <span class="o">=</span> <span class="n">in_cache</span><span class="p">(</span><span class="n">factorial</span><span class="p">)</span>
</code></pre></div></div>

<p><strong><em>in_cache</em> 는 함수를 받아 Memoization 코드를 추가해 다시 함수를 반환하는 함수로, 위에서는 반환된 클로저를 다시 <em>factorial</em> 이라는 이름으로 재할당했다.</strong></p>

<p>이 작업은 데코레이터가 정확히 하는 일이기도 하다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">in_cache</span>
<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div></div>

<p><br id="4" /></p>

<h2 id="4-closure-사용시의-장점">4. Closure 사용시의 장점</h2>

<hr />

<p>그럼 클로저를 사용하면 대체 뭐가 좋을까? 아까의 <em>factorial</em> 예제를 보자. <strong>캐시를 자신의 스코프 안에 저장하는 대신 그냥 전역변수로 두고 쓰면 되잖아? 왜 귀찮게 클로저를 만들어서 해야 하는거야?</strong> 충분히 던질 수 있는 질문이다.</p>

<p><img src="/assets/img/python/enclosure-cage.png" alt="Enclosure png with enclosed cage" /></p>

<p>아까 살펴 본 이미지다. 우리는 공유지에 각 개인의 소유 가축을 모두 풀어놓지 않고 울타리를 둘러쳐 자신의 영역을 구축한다.</p>

<p>결과적으로 이렇게 하는 이유와 Closure 사용의 장점이 일맥상통한다.</p>

<ul>
  <li>관리와 책임을 명확히 할 수 있고</li>
  <li>각 변수가 섞여 불필요한 충돌을 방지할 수 있으며</li>
  <li>사용환경(context)에 맞게 임의대로 내부구조를 조정할 수 있다.</li>
</ul>

<p><br /></p>

<p>이 장점을 현실적인 예로 살펴보자. 앞서 우리는 <em>factorial</em> 함수를 정의했다. 추가로 1부터 N까지의 합을 구해 반환하는 <em>sum_to_N</em> 함수를 정의해서 같이 사용해야 한다고 하자.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sum_to_N</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">s</span>


<span class="n">sum_to_N</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="mi">55</span>
</code></pre></div></div>

<p><strong>이 함수 또한 빈번하게 호출된다면 Memoization을 통해 효율성을 높일 수 있다.</strong> 그러면, 이런 비슷한 함수가 있을 때마다 전역공간에 cache를 두고 사용할 수 있는가? 10!은 3628800이고 1부터 10까지의 합은 55다. 전혀 다른 숫자기 때문에 같은 이름의 캐시를 쓸 수 없고, 굳이 전역공간에 캐시를 둔다면 cache_factorial, cache_sum_n과 같은 딱 보기에도 안쓰러운 이름의 변수를 써야 한다.</p>

<p>하지만 스코프를 분리해주고 자신의 스코프 안에서만 관리되는 캐시를 쓴다면 두 캐시가 충돌하지 않게 되서 사용성이 훨씬 커진다.</p>

<p>이걸 이렇게 그림으로 표현할 수도 있을까?</p>

<p><img src="/assets/img/python/enclosure-cache.png" alt="Enclosured cache" /></p>

<p>각 함수가 자신만의 스코프 안에서 고유한 cache를 유지하고 이 값을 문제없이 사용한다. 저 캐시들을 전역변수에 할당하고 사용해야 한다면 정말 끔찍할 것이다.</p>

<p>여기서 <code class="highlighter-rouge">Closure</code>라는 단어의 의미를 이렇게 정의해볼 수도 있겠다. <strong>Closure는 폐쇄라는 뜻을 갖는데, 어떤 굳게 닫힌 문을 연상시킨다. 굳게 닫힌 문이라도 언젠가는 열리기 마련이고, 우리는 이 문을 통해 해당 스코프에 대한 간접적인 접근이 가능하다.</strong> 클로저가 하는 일이 바로 그런 것이 아닌가? 클로저를 호출해서 그 스코프 안의 변수에 접근하고 있으니… 그 이외의 방법으로 접근하는 것은 불가능하다.</p>

<p><br id="5" /></p>

<h2 id="5-마치며">5. 마치며</h2>

<hr />

<p>클로저에 대해 살펴봤다. 또 길어졌는데 묵은 통증이 싹 사라지는 느낌이다. 이제 누군가에게 파이썬 클로저에 대해 확실히 설명할 수 있을 것 같다. 다행이다. :)</p>

<p>근데 포스트를 잘 만들었는지는 모르겠다. 더 쉽게, 더 간결하게 쓸 수는 없었나? 이게 최선이었나? 이 정도 글에서도 헤매는 나를 보니 수백 페이지의 책을 쓰는 사람들은 정말 대단하게 느껴진다. 하지만 포기하지 않는다. 또다시 달려볼 수밖에.</p>

<p>이상 포스트를 마칩니다.</p>

<p><br id="6" /></p>

<h2 id="6-자료-출처">6. 자료 출처</h2>

<hr />

<ul>
  <li><a href="https://www.geeksforgeeks.org/python-closures/" target="_blank">GeeksforGeeks: Python closures</a></li>
  <li><a href="https://shoark7.github.io/programming/algorithm/several-ways-to-solve-factorial-in-python.html" target="_blank">Parkito’s on the way: several ways to solve factorials in Python</a></li>
  <li><a href="https://www.programiz.com/python-programming/closure" target="_blank">Programiz: Python closures</a></li>
  <li><a href="https://stackoverflow.com/questions/14413946/what-exactly-is-contained-within-a-obj-closure" target="_blank">Stackoverflow: what exactly is contained within a obj closure</a></li>
  <li><a href="https://en.wikipedia.org/wiki/First-class_citizen" target="_blank">Wikipedia: First-class citizen</a></li>
</ul>

      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Python의 Closure에 대해 알아보자&url=http://localhost:4000/programming/python/closure-in-python" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=http://localhost:4000/programming/python/closure-in-python" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=http://localhost:4000/programming/python/closure-in-python" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
            <a href="/tags#Closure" class="tag">&#35; Closure</a>
          
        </div>
      </div>

			<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- 처음과끝에만 -->
			<ins class="adsbygoogle"
					 style="display:block"
					 data-ad-client="ca-pub-2670967175857332"
					 data-ad-slot="3352812061"
					 data-ad-format="auto"
					 data-full-width-responsive="true"></ins>
			<script>
					 (adsbygoogle = window.adsbygoogle || []).push({});
			</script>
			<!-- 처음과끝에만 -->

		  <!-- Load Facebook SDK for JavaScript -->
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <!-- Your share button code -->
  <div class="fb-share-button" 
    data-href="http://localhost:4000/programming/python/closure-in-python" 
    data-layout="button_count">
  </div>

		
    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

	<script src="https://unpkg.com/simple-jekyll-search@1.5.0/dest/simple-jekyll-search.min.js"></script>
<script>
var sjs = SimpleJekyllSearch({
  searchInput: document.querySelector('#search-input'),
  resultsContainer: document.getElementById('results-container'),
  json: '/search.json',
  searchResultTemplate: '<li class="search-results-item"><a href="http://localhost:4000{url}">{title}</a></li>',
	limit: 9,
	noResultsText: '<li class="search-results-item"><a href="#">No results found...</a></li>'
})
</script>

	<!-- Main Js -->
<!--<script src="/assets/js/main.js"></script>-->

<!-- JQuery 3.x min -->
<script src="/assets/js/jquery.js"></script>

<script>
	let menus = $("#category-list");
	let image = $("#menu-toggler img");
	$("#toggler-wrapper").click(function() {
		if(menus.css("display") === "none") {
			image.attr("src", "/assets/img/close-button.png");
			menus.css("display", "flex");
		}
		else {
			image.attr("src", "/assets/img/nav-off.png");
			menus.css("display", "none");
		}
	});


</script>

	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-127149179-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127149179-1');
</script>

</body>
</html>
